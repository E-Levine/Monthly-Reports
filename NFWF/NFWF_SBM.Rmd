---
output: 
  word_document:
  toc: true
---

```{r VariableSet, echo = FALSE, warning = FALSE, message = FALSE}
# Set your variables
ReportEnd <- as.Date("2023-12-30")  # Report End Date
Database = "OysterLocalMD20240112"  # Set the local database to use
```

```{r PackageLoad, echo = FALSE, warning = FALSE, message = FALSE}
# Load necessary R packages
library(tidyverse)
library(odbc)
library(DBI)
library(dbplyr)
library(lubridate)
library(knitr)
library(ggpubr)
library(patchwork) #Required for arranging multiple plots, more flexible
library(scales)
```

```{r ConfigureChunks, warning=FALSE, include=FALSE}
# Configure chunks
knitr::opts_chunk$set(
	echo = FALSE,
	fig.height = 10,
	fig.width = 8,
	message = FALSE,
	warning = FALSE
)

ReportStart <- floor_date(ReportEnd %m-% months(14), unit = "month") 
QuarterStart <- floor_date(ReportEnd %m-% months(2), unit = "month")
Estuaries <- c("AB", "SS")
```

```{r DatabaseDownload}
# Connect to Local database server and pull all necessary data, then close connection 
con <- dbConnect(odbc(),
                    Driver = "SQL Server", 
                    Server = "localhost\\MATTLOCALSQL",
                    Database = Database,
                    Authentication = "ActiveDirectoryIntegrated")

dboFixedLocations <- tbl(con,in_schema("dbo", "FixedLocations")) %>%
  collect() %>% 
  filter(Estuary %in% Estuaries)

hsdbSBMQuadrat <- tbl(con,in_schema("hsdb", "ShellBudgetQuadrat")) %>%
  collect() %>%
  filter(substring(SampleEventID, 1, 2) %in% Estuaries)
  
dboSBMQuadrat <- tbl(con,in_schema("dbo", "ShellBudgetQuadrat")) %>%
  collect() %>%
  filter(substring(SampleEventID, 1, 2) %in% Estuaries)

hsdbSBMSH <- tbl(con,in_schema("hsdb", "ShellBudgetSH")) %>%
  collect() %>%
  filter(substring(QuadratID, 1, 2) %in% Estuaries)

dboSBMSH <- tbl(con,in_schema("dbo", "ShellBudgetSH")) %>%
  collect()%>%
  filter(substring(QuadratID, 1, 2) %in% Estuaries)

DBI::dbDisconnect(con)

```

```{r DataFilters}
# Filter data frames so that only data collected for inclusion in the NFWF Report are present.
FixedLocations1 <- dboFixedLocations %>% 
  filter(ShellBudget == "Y") %>% #Remove filter if combining with New Report
  mutate(StationNumber = as.numeric(StationNumber)) %>%
  select(FixedLocationID,
         Estuary,
         StationNameNumber,
         StationNumber) %>% 
  distinct()
     
### QUADRATS ###     
SBM_Quad1 <- union_all(dboSBMQuadrat, hsdbSBMQuadrat) %>%
  mutate(TripDate = as.Date(substring(QuadratID, 8, 15), format = "%Y%m%d"),
       FixedLocationID = substring(QuadratID, 19, 22),
       Year = year(TripDate),
       OtherWeight = DrillWeight + OtherBiotaWeight + BlackAndOtherSubstrateWeight) %>%
  left_join(FixedLocations1, SampleEvent1, by = c("FixedLocationID")) %>%
  arrange(TripDate, StationNumber) %>%
  mutate(Survey = case_when(
        month(ymd(TripDate)) >= 1 & month(ymd(TripDate)) <= 3 ~ "Winter",
        month(ymd(TripDate)) >= 4 & month(ymd(TripDate)) <= 6 ~ "Spring",
        month(ymd(TripDate)) >= 7 & month(ymd(TripDate)) <= 9 ~ "Summer",
        month(ymd(TripDate)) > 9 ~ "Fall",
        TRUE ~ "Invalid")) %>%
  select(QuadratID, 
         SampleEventID, 
         TripDate, 
         Estuary,
         FixedLocationID, 
         StationNameNumber,
         StationNumber,
         Survey, 
         Year, 
         NumLiveOysters, 
         NumDrills, 
         TotalSampleWeight, 
         LiveOysterWeight, 
         OysterShellWeight, 
         PlantedShellWeight, 
         ShellHashWeight, 
         OtherWeight, 
         Comments)

### Provide stats for mean number of live oys (Fig 4); mean number of drills (Fig 7); mean weight (Fig 8)
SBM_QuadStats1 <- SBM_Quad1 %>%
  filter(TripDate > ReportStart) %>%
  mutate(OysterDensity = NumLiveOysters * 4,
         DrillDensity = NumDrills * 4,
         WeightDensity = TotalSampleWeight * 4,
         Survey_Year = paste(Survey, Year, sep = " ")) %>%
  group_by(TripDate, 
           Survey_Year, 
           Survey, 
           Year, 
           FixedLocationID,
           StationNameNumber,
           StationNumber) %>%
  summarise(OysterDensityMean = mean(OysterDensity, na.rm = TRUE),
            OysterDensitySD = sd(OysterDensity, na.rm = TRUE),
            DrillDensityMean = mean(DrillDensity, na.rm = TRUE),
            DrillDensitySD = sd(DrillDensity, na.rm = TRUE),
            WeightDensityMean = mean(WeightDensity, na.rm = TRUE),
            WeightDensitySD = sd(WeightDensity, na.rm = TRUE)) %>%
  arrange(Year, TripDate, StationNumber)

### Provide stats for mean weights of components (Fig 9)
SBM_QuadStats2 <- SBM_Quad1 %>%
  filter(TripDate > QuarterStart) %>% 
  mutate(LiveOysterWeightDensity = LiveOysterWeight * 4,
         OysterShellWeightDensity = OysterShellWeight * 4,
         PlantedShellWeightDensity = PlantedShellWeight * 4,
         ShellHashWeightDensity = ShellHashWeight * 4,
         OtherWeightDensity = OtherWeight * 4) %>%
  group_by(Survey, 
           Year, 
           FixedLocationID, 
           StationNameNumber,
           StationNumber) %>%
  summarise(LiveOysterWeightMean = mean(LiveOysterWeightDensity, na.rm = TRUE),
            LiveOysterWeightSD = sd(LiveOysterWeightDensity, na.rm = TRUE),
            OysterShellWeightMean = mean(OysterShellWeightDensity, na.rm = TRUE),
            OysterShellWeightSD = sd(OysterShellWeightDensity, na.rm = TRUE),
            PlantedShellWeightMean = mean(PlantedShellWeightDensity, na.rm = TRUE),
            PlantedShellWeightSD = sd(PlantedShellWeightDensity, na.rm = TRUE),
            ShellHashWeightMean = mean(ShellHashWeightDensity, na.rm = TRUE),
            ShellHashWeightSD = sd(ShellHashWeightDensity, na.rm = TRUE),
            OtherWeightMean = mean(OtherWeightDensity, na.rm = TRUE),
            OtherWeightSD = sd(OtherWeightDensity, na.rm = TRUE)) %>%
  arrange(StationNumber)

### SHELL HEIGHTS ###
SBM_SH1 <- union_all(dboSBMSH, hsdbSBMSH) %>%
  mutate(TripDate = as.Date(substring(QuadratID, 8, 15), format = "%Y%m%d"),
       FixedLocationID = substring(QuadratID, 19, 22),
       Year = year(TripDate)) %>%
  left_join(FixedLocations1, SampleEvent1, by = c("FixedLocationID")) %>%
  arrange(TripDate, StationNumber) %>%
  mutate(Survey = case_when(
        month(ymd(TripDate)) >= 1 & month(ymd(TripDate)) <= 3 ~ "Winter",
        month(ymd(TripDate)) >= 4 & month(ymd(TripDate)) <= 6 ~ "Spring",
        month(ymd(TripDate)) >= 7 & month(ymd(TripDate)) <= 9 ~ "Summer",
        month(ymd(TripDate)) > 9 ~ "Fall",
        TRUE ~ "Invalid")) %>%
  filter(ShellHeightID != "#N/A") %>% ### Remove line once hsdb has been repaired
  mutate(Survey_Year = paste(Survey, Year, sep = " ")) %>%
  select(ShellHeightID, 
         QuadratID, 
         TripDate, 
         FixedLocationID, 
         StationNameNumber,
         StationNumber,
         Survey_Year,
         Survey, 
         Year, 
         LiveOrDead, 
         ShellHeight)

### Provides stats for Mean Shell Height LIVE (Fig 5)
SBM_SHStatsLive <- SBM_SH1 %>%
  filter(TripDate > ReportStart & LiveOrDead == "Live") %>%
  group_by(Survey_Year,
           Survey,
           Year,
           TripDate,
           FixedLocationID, 
           StationNameNumber, 
           StationNumber) %>%
  summarise(SHMean = mean(ShellHeight, na.rm = TRUE),
            SHSD = sd(ShellHeight, na.rm = TRUE)) %>%
  arrange(Year, TripDate, StationNumber)

### Provides stats for Mean Shell Height DEAD (Fig 6)
SBM_SHStatsDead <- SBM_SH1 %>%
  filter(TripDate > ReportStart & LiveOrDead == "Live") %>%
  group_by(Survey_Year,
           Survey,
           Year,
           TripDate,
           FixedLocationID, 
           StationNameNumber, 
           StationNumber) %>%
  summarise(SHMean = mean(ShellHeight, na.rm = TRUE),
            SHSD = sd(ShellHeight, na.rm = TRUE)) %>%
  arrange(Year, TripDate, StationNumber)

### Provides stats for report text
SBM_QuadTextStats <- SBM_QuadStats1 %>%
  filter(TripDate > QuarterStart) 

SBM_QuadWeightStats <- SBM_QuadStats2 %>%
  mutate(TotalWt = LiveOysterWeightMean + OysterShellWeightMean + PlantedShellWeightMean + ShellHashWeightMean + OtherWeightMean)

SBM_SHLiveTextStats <- SBM_SHStatsLive %>%
  filter(TripDate > QuarterStart)

SBM_SHDeadTextStats <- SBM_SHStatsDead %>%
  filter(TripDate > QuarterStart)

ReportTotalLive <- SBM_SH1 %>%
  filter(ShellHeight > 0 & TripDate > QuarterStart & LiveOrDead == "Live")

```

```{r SBMReportText}
#Report Text in area below
```

APALACHICOLA BAY  
Preliminary shell budget data is available through the end of `r format(max(SBM_Quad1$TripDate), "%B %Y")`.

Live oysters were present at all stations in the most recent samples (Fig. XXX). Mean oyster densities ranged from `r round(min(SBM_QuadTextStats$OysterDensityMean, na.rm = TRUE), 0)` oysters/m² at `r SBM_QuadTextStats$StationNameNumber[which.min(SBM_QuadTextStats$OysterDensityMean)]` to `r round(max(SBM_QuadTextStats$OysterDensityMean, na.rm = TRUE), 0)` oysters/m² at `r SBM_QuadTextStats$StationNameNumber [which.max(SBM_QuadTextStats$OysterDensityMean)]`. Mean densities were generally highest at stations which were recently cultched (Lighthouse, East Lumps, and Cat Point) though nearly all were recently settled spat. 

Live oyster shell height means ranged from `r round(min(SBM_SHLiveTextStats$SHMean, na.rm = TRUE), 0)` to `r round(max(SBM_SHLiveTextStats$SHMean, na.rm = TRUE), 0)` mm (Fig. 5) and an overall average shell height of `r round(mean(SBM_SHLiveTextStats$SHMean, na.rm = TRUE), 0)` mm. There were `r sum(ReportTotalLive$ShellHeight > 30)` oysters larger than 30 mm measured (`r percent(sum(ReportTotalLive$ShellHeight > 30) / nrow(ReportTotalLive), accuracy = 0.1)` of total measured), and there were `r sum(ReportTotalLive$ShellHeight > 75)` oyster of legal harvest size (SH>=76 mm) measured (`r percent(sum(ReportTotalLive$ShellHeight > 75) / nrow(ReportTotalLive), accuracy = 0.1)` of total measured) during this quarter.

Dead oysters were collected at most stations. Dead oyster shell heights averages ranged from `r round(min(SBM_SHDeadTextStats$SHMean, na.rm = TRUE), 0)` to `r round(max(SBM_SHDeadTextStats$SHMean, na.rm = TRUE), 0)` mm (Fig. 6) and the overall average shell height of dead oysters was `r round(mean(SBM_SHDeadTextStats$SHMean, na.rm = TRUE), 0)` mm.

Oyster drills (Stramonita floridana) were found at some station this quarter. Mean oyster drill densities ranged from `r round(min(SBM_QuadTextStats$DrillDensityMean, na.rm = TRUE), 0)` to `r round(max(SBM_QuadTextStats$DrillDensityMean, na.rm = TRUE), 0)` oyster drill/m² (Fig. 7).

Substrate weights were measured for all parcels (Figure 8). Substrate weights were highest at stations which were recently cultched (Lighthouse, East Lumps, and Cat Point). The main substrate components accounted for `r percent((sum(SBM_QuadWeightStats$TotalWt) - sum(SBM_QuadWeightStats$OtherWeightMean)) / sum(SBM_QuadWeightStats$TotalWt), accuracy = 0.1)` of total weight which were: cultch (`r percent(sum(SBM_QuadWeightStats$PlantedShellWeightMean) / sum(SBM_QuadWeightStats$TotalWt), accuracy = 0.1)` of total weight), shell hash (`r percent(sum(SBM_QuadWeightStats$ShellHashWeightMean) / sum(SBM_QuadWeightStats$TotalWt), accuracy = 0.1)` of total weight), live oysters (`r percent(sum(SBM_QuadWeightStats$LiveOysterWeightMean) / sum(SBM_QuadWeightStats$TotalWt), accuracy = 0.1)` of total weight) and oyster shell (`r percent(sum(SBM_QuadWeightStats$OysterShellWeightMean) / sum(SBM_QuadWeightStats$TotalWt), accuracy = 0.1)` of total weight). Proportions of substrate components differed between parcels with shell hash and cultch being the predominant substrate types (Figure 9). 

```{r FigureFormatting}

#Base formatting for figure consistency
BaseForm <- theme_classic() +
  theme(panel.border = element_rect(color = "black", fill = NA), #Add border
        plot.title = element_text(hjust = 0, vjust = -7, family = "serif", color = "black", size = 12), #Add plot title for section
        axis.title = element_text(family = "serif", color = "black", size = 12), #Adjust axis title and text
        axis.text = element_text(family = "serif", color = "black", size = 10),
        axis.line = element_line(color = "black"),
        axis.ticks.length.x = unit(0.20, "cm"),
        axis.ticks.length.y = unit(0.1, "cm"),
        legend.position = "top", legend.justification = "right",  legend.box.spacing = unit(0.05, "line"), #Adjust legend position
        legend.title = element_blank(), legend.key.height = unit(0.5, "line"), legend.key.width = unit(1, "lines"), #Adjust legend title and spacing
        legend.text = element_text(family = "serif", color = "black", size = 9)) #Adjust legend text



knit_exit()
```

```{r}
#Creating Shell Budget figures Mean Live Oysters
#

df_source <- SBM_QuadStats1 %>%
  mutate(Upper = OysterDensityMean + OysterDensitySD)### if using a loop, this is a variable 
max_upper <- max(ungroup(df_source) %>%  
                   dplyr::select(Upper), na.rm = TRUE)

SBM_plot_list <- df_source %>% 
  ggplot(aes(x = factor(Survey_Year, levels = unique(Survey_Year)), 
             y = OysterDensityMean, 
             color = StationNameNumber, 
             fill = as.factor(StationNameNumber)))+ 
  geom_bar(stat = "identity", 
           position = position_dodge(width = 0.9),
           color = "black") + 
  geom_errorbar(aes(ymin = OysterDensityMean, ymax = Upper), 
                position = position_dodge(width = 0.9), 
                width = 0.25, color = "black")+ 
  scale_x_discrete("Survey", expand = c(0.005, 0), 
                 guide = guide_axis(angle = -45))+
  scale_y_continuous(expression("Live oysters / m"^2), expand = c(0, 0),
                   limits = c(0, ceiling(max_upper * 1.05)), #Provides a 5% buffer to the top of bars
                   breaks = pretty(0:2 * ceiling(max(ungroup(df_source) %>% 
                                                     dplyr::select(Upper), na.rm = TRUE) / 2))) + 
  ggtitle("AB SBM Oy Density") + 
  BaseForm +
  theme(legend.position = "bottom",
        plot.title = element_text(hjust = 0, vjust = 0))


print(SBM_plot_list)


```


```{r}
#Creating Shell Budget figures Mean live shell heights
#

df_source <- SBM_SHStatsLive %>%
  mutate(Upper = SHMean + SHSD)### if using a loop, this is a variable 
max_upper <- max(ungroup(df_source) %>%  
                   dplyr::select(Upper), na.rm = TRUE)

SBM_plot_list <- df_source %>% 
  ggplot(aes(x = factor(Survey_Year, levels = unique(Survey_Year)), 
             y = SHMean, 
             color = StationNameNumber, 
             fill = as.factor(StationNameNumber)))+ 
  geom_bar(stat = "identity", 
           position = position_dodge(width = 0.9),
           color = "black") + 
  geom_errorbar(aes(ymin = SHMean, ymax = Upper), 
                position = position_dodge(width = 0.9), 
                width = 0.25, color = "black")+ 
  scale_x_discrete("Survey", expand = c(0.005, 0), 
                 guide = guide_axis(angle = -45))+
  scale_y_continuous("Live Shell Height (mm)", expand = c(0, 0),
                   limits = c(0, ceiling(max_upper * 1.05)), #Provides a 5% buffer to the top of bars
                   breaks = pretty(0:2 * ceiling(max(ungroup(df_source) %>% 
                                                     dplyr::select(Upper), na.rm = TRUE) / 2))) + 
  ggtitle("AB SBM Live Shell Heights") + 
  BaseForm +
  theme(legend.position = "bottom",
        plot.title = element_text(hjust = 0, vjust = 0))


print(SBM_plot_list)

```


```{r}
#Creating Shell Budget figures Mean dead shell heights
#

df_source <- SBM_SHStatsDead %>%
  mutate(Upper = SHMean + SHSD)### if using a loop, this is a variable 
max_upper <- max(ungroup(df_source) %>%  
                   dplyr::select(Upper), na.rm = TRUE)

SBM_plot_list <- df_source %>% 
  ggplot(aes(x = factor(Survey_Year, levels = unique(Survey_Year)), 
             y = SHMean, 
             color = StationNameNumber, 
             fill = as.factor(StationNameNumber)))+ 
  geom_bar(stat = "identity", 
           position = position_dodge(width = 0.9),
           color = "black") + 
  geom_errorbar(aes(ymin = SHMean, ymax = Upper), 
                position = position_dodge(width = 0.9), 
                width = 0.25, color = "black")+ 
  scale_x_discrete("Survey", expand = c(0.005, 0), 
                 guide = guide_axis(angle = -45))+
  scale_y_continuous("Live Shell Height (mm)", expand = c(0, 0),
                   limits = c(0, ceiling(max_upper * 1.05)), #Provides a 5% buffer to the top of bars
                   breaks = pretty(0:2 * ceiling(max(ungroup(df_source) %>% 
                                                     dplyr::select(Upper), na.rm = TRUE) / 2))) + 
  ggtitle("AB SBM Dead Shell Heights") + 
  BaseForm +
  theme(legend.position = "bottom",
        plot.title = element_text(hjust = 0, vjust = 0))


print(SBM_plot_list)


```


```{r}
#Creating Shell Budget figures Mean Oyster drill density
#

df_source <- SBM_QuadStats1 %>%
  mutate(Upper = DrillDensityMean + DrillDensitySD)### if using a loop, this is a variable 
max_upper <- max(ungroup(df_source) %>%  
                   dplyr::select(Upper), na.rm = TRUE)

SBM_plot_list <- df_source %>% 
  ggplot(aes(x = factor(Survey_Year, levels = unique(Survey_Year)), 
             y = DrillDensityMean, 
             color = StationNameNumber, 
             fill = as.factor(StationNameNumber)))+ 
  geom_bar(stat = "identity", 
           position = position_dodge(width = 0.9),
           color = "black") + 
  geom_errorbar(aes(ymin = DrillDensityMean, ymax = Upper), 
                position = position_dodge(width = 0.9), 
                width = 0.25, color = "black")+ 
  scale_x_discrete("Survey", expand = c(0.005, 0), 
                 guide = guide_axis(angle = -45))+
  scale_y_continuous(expression("Live drills / m"^2), expand = c(0, 0),
                   limits = c(0, ceiling(max_upper * 1.05)), #Provides a 5% buffer to the top of bars
                   breaks = pretty(0:2 * ceiling(max(ungroup(df_source) %>% 
                                                     dplyr::select(Upper), na.rm = TRUE) / 2))) + 
  ggtitle("AB SBM Drill Density") + 
  BaseForm +
  theme(legend.position = "bottom",
        plot.title = element_text(hjust = 0, vjust = 0))


print(SBM_plot_list)


```


```{r}
#Creating Shell Budget figures Mean Weights
#

df_source <- SBM_QuadStats1 %>%
  mutate(Upper = WeightDensityMean + WeightDensitySD)### if using a loop, this is a variable 
max_upper <- max(ungroup(df_source) %>%  
                   dplyr::select(Upper), na.rm = TRUE)

SBM_plot_list <- df_source %>% 
  ggplot(aes(x = factor(Survey_Year, levels = unique(Survey_Year)), 
             y = WeightDensityMean, 
             color = StationNameNumber, 
             fill = as.factor(StationNameNumber)))+ 
  geom_bar(stat = "identity", 
           position = position_dodge(width = 0.9),
           color = "black") + 
  geom_errorbar(aes(ymin = WeightDensityMean, ymax = Upper), 
                position = position_dodge(width = 0.9), 
                width = 0.25, color = "black")+ 
  scale_x_discrete("Survey", expand = c(0.005, 0), 
                 guide = guide_axis(angle = -45))+
  scale_y_continuous(expression("Mean Weight (kg / m"^2), expand = c(0, 0),
                   limits = c(0, ceiling(max_upper * 1.05)), #Provides a 5% buffer to the top of bars
                   breaks = pretty(0:2 * ceiling(max(ungroup(df_source) %>% 
                                                     dplyr::select(Upper), na.rm = TRUE) / 2))) + 
  ggtitle("AB SBM Mean Weight") + 
  BaseForm +
  theme(legend.position = "bottom",
        plot.title = element_text(hjust = 0, vjust = 0))


print(SBM_plot_list)


```

```{r}
#Creating Shell Budget figures Component Weight
#

datalonag <- SBM_QuadStats2 %>%
  rename_at(vars(ends_with("SD")), ~gsub("SD$", "_SD", .)) %>%
  rename_at(vars(ends_with("Mean")), ~gsub("Mean$", "_Mean", .))


  

df_source <- SBM_QuadStats2 %>%
  rename_at(vars(ends_with("SD")), ~gsub("SD$", "_SD", .)) %>%
  rename_at(vars(ends_with("Mean")), ~gsub("Mean$", "_Mean", .)) %>%
  pivot_longer(cols = -StationNameNumber, names_to = c(".value", "Y"), names_sep = "_") 


  mutate(Upper = LiveOysterWeightMean + LiveOysterWeightSD)### if using a loop, this is a variable 
max_upper <- max(ungroup(df_source) %>%  
                   dplyr::select(Upper), na.rm = TRUE)

SBM_plot_list <- df_source %>% 
  ggplot(aes(x = factor(StationNameNumber, levels = unique(StationNameNumber)), 
             y = OysterDensityMean, 
             color = StationNameNumber, 
             fill = as.factor(StationNameNumber)))+ 
  geom_bar(stat = "identity", 
           position = position_dodge(width = 0.9),
           color = "black") + 
  geom_errorbar(aes(ymin = OysterDensityMean, ymax = Upper), 
                position = position_dodge(width = 0.9), 
                width = 0.25, color = "black")+ 
  scale_x_discrete("Survey", expand = c(0.005, 0), 
                 guide = guide_axis(angle = -45))+
  scale_y_continuous(expression("Live oysters / m"^2), expand = c(0, 0),
                   limits = c(0, ceiling(max_upper * 1.05)), #Provides a 5% buffer to the top of bars
                   breaks = pretty(0:2 * ceiling(max(ungroup(df_source) %>% 
                                                     dplyr::select(Upper), na.rm = TRUE) / 2))) + 
  ggtitle("AB SBM Oy Density") + 
  BaseForm +
  theme(legend.position = "bottom",
        plot.title = element_text(hjust = 0, vjust = 0))


print(SBM_plot_list)


```


```{r}
library(openxlsx)

mydatasets <- list('Sheet1' = SBM_QuadStats1, 'Sheet2' = SBM_QuadStats2, 'Sheet3' = SBM_SHStatsLive, 'Sheet4' = SBM_SHStatsDead)
write.xlsx(mydatasets, "SBM_ReportStats.xlsx", colNames = TRUE, rowNames = FALSE)

```

